id: ticket_summary_workflow
namespace: local.grievances
tasks:
  - id: summarize
    type: io.kestra.core.tasks.scripts.Bash
    description: "Summarize the complaint and classify urgency"
    commands:
      - |
        #!/bin/bash
        COMPLAINT="{{inputs.complaint}}"

        if [[ "$COMPLAINT" == *"garbage"* ]]; then
          echo '{"summary": "Garbage dumped near road", "urgency": "Medium"}' > output.json
        elif [[ "$COMPLAINT" == *"pothole"* ]]; then
          echo '{"summary": "Pothole on street", "urgency": "High"}' > output.json
        elif [[ "$COMPLAINT" == *"sewage"* || "$COMPLAINT" == *"leak"* ]]; then
          echo '{"summary": "Sewage leak reported", "urgency": "High"}' > output.json
        else
          echo '{"summary": "General complaint", "urgency": "Low"}' > output.json
        fi
    output:
      path: output.json
